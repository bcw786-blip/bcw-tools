name: Build BCW Ultimate App
on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Create Local Manifest
        run: |
          echo '{
            "name": "BCW Tools",
            "short_name": "BCW",
            "start_url": "https://bcw786-blip.github.io/bcw-tools/",
            "display": "standalone",
            "background_color": "#ffffff",
            "theme_color": "#000000",
            "icons": [{"src": "icon.png", "sizes": "512x512", "type": "image/png"}],
            "permissions": [
              "camera",
              "microphone",
              "geolocation",
              "storage",
              "notifications"
            ]
          }' > local_manifest.json

      - name: Build APK Locally
        run: |
          npm install -g @bubblewrap/cli
          npx bubblewrap build --manifest=local_manifest.json --skipIntermediatePrompt || true

      - name: Upload BCW App
        uses: actions/upload-artifact@v4
        with:
          name: BCW-Tools-Final
          path: ./**/*.apk
          if-no-files-found: warn
